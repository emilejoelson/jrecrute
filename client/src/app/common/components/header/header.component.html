<header
  #headerElement
  class="transition-colors duration-300 z-[9999] sticky top-0 left-0 w-full flex items-center justify-between gap-2 px-app-secondary-padding xl:px-app-primary-padding min-h-[100px]"
>
  <div
    #progressBarElement
    class="transition-all duration-300 ease-out absolute left-0 bottom-0 h-[2px] bg-purple-500"
  ></div>
  <a class="cursor-pointer min-w-[143px]" href="/">
    <div class="flex items-center gap-2">
      <img
        #logoImage
        class="w-10 h-10 object-contain"
        src="assets/icons/cc-logo.png"
        alt="Logo"
      />
      <span class="text-2xl font-bold text-gradient">{{
        "APP_NAME" | translate
      }}</span>
    </div>
  </a>

  <nav
    class="overflow-auto transition-transform duration-300 ease-out bg-white absolute top-full p-app-secondary-padding left-0 h-screen w-full transform {{
      isNavOpen ? 'translate-y-0' : '-translate-y-[calc(100%+100px)]'
    }} xl:relative xl:translate-y-0 xl:h-auto xl:w-auto xl:bg-transparent xl:p-0 xl:overflow-visible"
  >
    <ul
      class="flex items-start gap-x-12 md:items-center md:gap-6 gap-y-8 custom-650:flex-col"
    >
      @for (linkEntry of navItems.links; track linkEntry){
      <li
        #navElement
        (click)="
          linkEntry.behaviour === 'scroll'
            ? scrollToSection(linkEntry.sectionId!)
            : null
        "
        [ngClass]="{
          'text-gray-800':
            currentRoute === '/client' ||
            currentRoute === '/inscription' ||
            currentRoute === '/connexion' ||
            currentRoute === '/mention-legal' ||
            currentRoute === '/deposer-un-cv' ||
            currentRoute === '/condition-general-de-vente' ||
            currentRoute === '/offre-d\'emploi/commercial' ||
            currentRoute === '/offre-d\'emploi/community-manager' ||
            currentRoute === '/offre-d\'emploi/developpeur-web' ||
            currentRoute === '/offre-d\'emploi/secretaire' ||
            currentRoute === '/offre-d\'emploi/profil-bilingue',
          'text-gray-600 custom-650:text-gray-600': !(
            currentRoute === '/client' ||
            currentRoute === '/inscription' ||
            currentRoute === '/connexion' ||
            currentRoute === '/mention-legal' ||
            currentRoute === '/deposer-un-cv' ||
            currentRoute === '/condition-general-de-vente' ||
            currentRoute === '/offre-d\'emploi/commercial' ||
            currentRoute === '/offre-d\'emploi/community-manager' ||
            currentRoute === '/offre-d\'emploi/developpeur-web' ||
            currentRoute === '/offre-d\'emploi/secretaire' ||
            currentRoute === '/offre-d\'emploi/profil-bilingue'
          )
        }"
        class="text-gray-300 hover:text-white cursor-pointer text-md font-medium transition-colors duration-200"
      >
        {{ linkEntry.translationKey | translate }}
      </li>
      } @for(buttonEntry of navItems.buttons;track buttonEntry){
      @if(buttonEntry.name !=='Client'){
      <button
        (click)="onDeposit()"
        class="bg-purple-600 hover:bg-purple-700 text-white font-medium px-3 py-1.5 rounded-md transition-colors duration-200"
      >
        {{ buttonEntry.translationKey | translate }}
      </button>
      } @else {
      <button
        (click)="onClient()"
        class="bg-gray-700 hover:bg-gray-600 text-white text-md font-medium px-3 py-1.5 rounded-md transition-colors duration-200"
      >
        {{ buttonEntry.translationKey | translate }}
      </button>
      } }
    </ul>
    <div class="flex items-center gap-4 mt-10 md:hidden">
      <div class="relative inline-flex border-gray-400 w-full border-t">
        <button
          (click)="toggleDropdown()"
          class="flex items-center gap-2 p-1.5 rounded bg-gray-200 w-full text-gray-300 hover:text-white hover:bg-gray-700 transition-colors duration-200"
        >
          <div>
            <img
              *ngIf="currentLanguage === 'FR'"
              src="/assets/flags/france.png"
              alt="Français"
              class="h-[14px] rounded-full"
            />
            <img
              *ngIf="currentLanguage === 'EN'"
              src="/assets/flags/united-kingdom.png"
              alt="English"
              class="h-[14px] rounded-full"
            />
          </div>
          <span class="font-medium text-xs text-gray-700">{{
            currentLanguage
          }}</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <div class="flex items-center gap-4">
    <div class="relative inline-flex">
      <button
        (click)="toggleDropdown()"
        class="flex items-center custom-650:hidden gap-2 p-1.5 rounded text-gray-300 hover:text-white hover:bg-gray-700 transition-colors duration-200"
      >
        <div>
          <img
            *ngIf="currentLanguage === 'FR'"
            src="/assets/flags/france.png"
            alt="Français"
            class="h-[14px] rounded-full"
          />
          <img
            *ngIf="currentLanguage === 'EN'"
            src="/assets/flags/united-kingdom.png"
            alt="English"
            class="h-[14px] rounded-full"
          />
        </div>
        <span class="font-medium text-xs">{{ currentLanguage }}</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-4 w-4"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
            clip-rule="evenodd"
          />
        </svg>
      </button>

      @if(dropdownOpen){
      <div
        class="fixed right-0 z-[1000] top-0 w-60 md:rounded-l-lg custom-650:w-screen h-screen bg-gray-800 border border-gray-700 focus:outline-none animate-fade-in-down shadow-lg overflow-hidden"
        (click)="$event.stopPropagation()"
      >
        <div
          class="p-3 border-b border-gray-700 flex items-center justify-between bg-gray-900"
        >
          <div class="flex items-center">
            <app-icon iconName="chooseLangueIcon" />
            <h3 class="text-white font-medium text-sm">Choisir la langue</h3>
          </div>
          <button
            (click)="toggleDropdown()"
            class="text-gray-400 hover:text-white transition-colors"
          >
            <app-icon iconName="closeLangueIcon" />
          </button>
        </div>

        <div
          class="p-3 bg-gradient-to-r from-gray-800 to-gray-800 text-xs text-gray-300 flex items-center"
        >
          <app-icon iconName="preferenceIcon" />
          <span>Personnalisez votre expérience avec votre langue préférée</span>
        </div>

        <!-- Language options -->
        <div class="py-2">
          <button
            (click)="switchLanguage('FR')"
            class="w-full flex items-center px-4 py-3 text-sm text-gray-300 hover:bg-gray-700 transition-colors duration-200"
            [ngClass]="{ 'bg-gray-700': currentLanguage === 'FR' }"
          >
            <img
              src="/assets/flags/france.png"
              alt="Français"
              class="h-[14px] mr-3 rounded-full"
            />
            <span class="flex-grow text-left">{{
              "LANGUAGE.0" | translate
            }}</span>
            <svg
              *ngIf="currentLanguage === 'FR'"
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4 text-purple-500"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd"
              />
            </svg>
          </button>

          <button
            (click)="switchLanguage('EN')"
            class="w-full flex items-center px-4 py-3 text-sm text-gray-300 hover:bg-gray-700 transition-colors duration-200"
            [ngClass]="{ 'bg-gray-700': currentLanguage === 'EN' }"
          >
            <img
              src="/assets/flags/united-kingdom.png"
              alt="English"
              class="h-[14px] mr-3 rounded-full"
            />
            <span class="flex-grow text-left">{{
              "LANGUAGE.1" | translate
            }}</span>
            <svg
              *ngIf="currentLanguage === 'EN'"
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4 text-purple-500"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
        </div>

        <div class="px-4 py-2 border-t border-gray-700 bg-gray-900">
          <button
            (click)="toggleDropdown()"
            class="text-xs text-[#616A76] hover:text-gray-100 flex items-center w-full justify-center"
          >
            <app-icon iconName="closeIcon" />
            Fermer
          </button>
        </div>
      </div>
      }
    </div>

    <!-- Profile Menu -->
    <!-- Profile Menu -->
    <div class="relative inline-flex">
      <!-- Profile Button with Dynamic Content -->
      <button
        (click)="toggleProfileMenu()"
        class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-700 hover:ring-2 hover:ring-gray-600 transition-all duration-200 overflow-hidden"
      >
        <ng-container *ngIf="isAuthenticated$ | async; else defaultAvatar">
          <!-- Show profile image if available -->
          <img
            *ngIf="
              (profileImageUrl$ | async) &&
              (profileImageUrl$ | async) !== 'assets/profile/user-avatar.jpg'
            "
            [src]="profileImageUrl$ | async"
            alt="Profile"
            class="w-full h-full object-cover"
          />
          <!-- Show initials if no profile image -->
          <span
            *ngIf="
              !(profileImageUrl$ | async) ||
              (profileImageUrl$ | async) === 'assets/profile/user-avatar.jpg'
            "
            class="text-gray-300 text-sm font-medium"
          >
            {{ getInitials(fullName$ | async) }}
          </span>
        </ng-container>
        <ng-template #defaultAvatar>
          <span class="text-gray-300 text-sm font-medium">
            {{ getInitials(fullName$ | async) }}
          </span>
        </ng-template>
      </button>

      @if(isProfileMenuOpen){
      <div
        class="fixed z-50 right-0 top-0 bottom-0 custom-650:w-screen flex flex-col h-screen md:rounded-l-xl shadow-lg bg-gray-800 px-5 border border-gray-700 ring-1 ring-black ring-opacity-5 focus:outline-none animate-fade-in-down"
        (click)="$event.stopPropagation()"
      >
        <!-- Header Section -->
        <div class="p-3 border-b border-gray-700">
          <div class="flex items-center justify-between gap-10">
            <!-- User Info -->
            <div class="flex items-center space-x-3">
              <!-- Dynamic Profile Image/Initials -->
              <div
                class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-700 overflow-hidden"
              >
                <ng-container
                  *ngIf="isAuthenticated$ | async; else defaultAvatarMenu"
                >
                  <!-- Show profile image if available -->
                  <img
                    *ngIf="
                      (profileImageUrl$ | async) &&
                      (profileImageUrl$ | async) !==
                        'assets/profile/user-avatar.jpg'
                    "
                    [src]="profileImageUrl$ | async"
                    alt="Profile"
                    class="w-full h-full object-cover"
                  />
                  <!-- Show initials if no profile image -->
                  <span
                    *ngIf="
                      !(profileImageUrl$ | async) ||
                      (profileImageUrl$ | async) ===
                        'assets/profile/user-avatar.jpg'
                    "
                    class="text-gray-300 text-sm font-medium"
                  >
                    {{ getInitials(fullName$ | async) }}
                  </span>
                </ng-container>
                <ng-template #defaultAvatarMenu>
                  <span class="text-gray-300 text-sm font-medium">
                    {{ getInitials(fullName$ | async) }}
                  </span>
                </ng-template>
              </div>
              <div>
                <p class="font-medium text-sm text-white">
                  {{ userEmail$ | async }}
                </p>
                <p class="text-xs text-gray-400">{{ fullName$ | async }}</p>
              </div>
            </div>

            <div class="flex items-center space-x-2">
              <button class="text-gray-400 hover:text-white">
                <app-icon iconName="refreshSyncIcon" />
              </button>
              <button
                class="text-gray-400 hover:text-white"
                (click)="toggleProfileMenu()"
              >
                <app-icon iconName="closeProfileIcon" />
              </button>
            </div>
          </div>
        </div>

        <!-- Menu Items Section -->
        <div class="py-1 flex-grow overflow-y-auto">
          <!-- Profile Section Title -->
          <div class="px-4 py-2">
            <h3
              class="text-xs font-semibold text-gray-400 uppercase tracking-wider"
            >
              {{ "PROFILE.SECTION_PROFILE" | translate }}
            </h3>
          </div>

          <!-- Show these menu items only if authenticated -->
          <ng-container
            *ngIf="isAuthenticated$ | async; else unauthenticatedMenuItems"
          >
            <a
              href="/profile"
              class="w-full flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 transition-colors duration-200"
            >
              <app-icon iconName="myprofileIcon" />
              <span>{{ "PROFILE.MY_PROFILE" | translate }}</span>
            </a>
            <a
              href="/account"
              class="w-full flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 transition-colors duration-200"
            >
              <app-icon iconName="profileAccountIcon" />
              <span>{{ "PROFILE.ACCOUNT" | translate }}</span>
            </a>

            <button
              class="w-full flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 transition-colors duration-200"
            >
              <app-icon iconName="settingIcon" />
              <span>{{ "PROFILE.SETTINGS" | translate }}</span>
            </button>

            <div class="border-t border-gray-700 my-3"></div>

            <button
              (click)="logout()"
              class="w-full flex items-center px-4 py-2 text-sm text-red-400 hover:bg-gray-700 transition-colors duration-200"
            >
              <app-icon iconName="logoutIcon" />
              <span>{{ "PROFILE.LOGOUT" | translate }}</span>
            </button>
          </ng-container>

          <!-- Show these menu items if not authenticated -->
          <ng-template #unauthenticatedMenuItems>
            <div class="px-4 py-2">
              <h3
                class="text-xs font-semibold text-gray-400 uppercase tracking-wider"
              >
                {{ "PROFILE.SECTION_AUTH" | translate }}
              </h3>
            </div>
            <button
              (click)="onLogin()"
              class="w-full flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 transition-colors duration-200"
            >
              <app-icon iconName="loginIcon" />
              <span>{{ "PROFILE.LOGIN" | translate }}</span>
            </button>
            <button
              (click)="onSignup()"
              class="w-full flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 transition-colors duration-200"
            >
              <app-icon iconName="signupIcon" />
              <span>{{ "PROFILE.SIGNUP" | translate }}</span>
            </button>
          </ng-template>
        </div>
      </div>
      }
    </div>
  </div>
  <button
    role="button"
    class="block transition-colors duration-300 ease-in-out p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 xl:hidden"
    (click)="toggleNav()"
  >
    @if (isNavOpen) {
    <app-icon iconName="navOpenIcon" />
    } @else {
    <app-icon iconName="navCloseIcon" />
    }
  </button>
</header>
