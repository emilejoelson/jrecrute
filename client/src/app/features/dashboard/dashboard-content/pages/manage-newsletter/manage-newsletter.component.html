<div class="flex flex-col h-full bg-gray-900 text-white">
  <div class="p-6 border-b border-gray-800">
    <div class="flex items-center justify-between mb-4">
      <h1 class="text-2xl font-semibold">Newsletter Management</h1>
      <button
        (click)="openCreateModal()"
        class="flex items-center bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors"
      >
        <app-icon iconName="newsletterCreateIcon" />
        Create Newsletter
      </button>
    </div>

    <!-- Analytics Stats -->
    <div
      *ngIf="analytics$ | async as analytics"
      class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"
    >
      <div class="bg-gray-800 rounded-lg p-4 flex flex-col">
        <div class="flex items-center text-purple-400 mb-2">
          <app-icon iconName="totalNewslettersIcon" />
          <span class="text-sm">Total Newsletters</span>
        </div>
        <div class="text-2xl font-bold">{{ analytics.totalNewsletters }}</div>
      </div>

      <div class="bg-gray-800 rounded-lg p-4 flex flex-col">
        <div class="flex items-center text-blue-400 mb-2">
          <app-icon iconName="publishedNewsletterIcon" />
          <span class="text-sm">Published</span>
        </div>
        <div class="text-2xl font-bold">
          {{ analytics.publishedNewsletters }}
        </div>
      </div>

      <div class="bg-gray-800 rounded-lg p-4 flex flex-col">
        <div class="flex items-center text-yellow-400 mb-2">
          <app-icon iconName="scheduledNewsletterIcon" />
          <span class="text-sm">Scheduled</span>
        </div>
        <div class="text-2xl font-bold">
          {{ analytics.scheduledNewsletters }}
        </div>
      </div>

      <div class="bg-gray-800 rounded-lg p-4 flex flex-col">
        <div class="flex items-center text-green-400 mb-2">
          <app-icon iconName="subscribersIcon" />
          <span class="text-sm">Subscribers</span>
        </div>
        <div class="text-2xl font-bold">{{ analytics.totalSubscribers }}</div>
      </div>
    </div>

    <!-- Filter Bar -->
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div class="flex items-center space-x-2">
        <button
          [class]="
            selectedFilter === null
              ? 'bg-purple-600 text-white'
              : 'bg-gray-700 text-gray-300'
          "
          class="px-3 py-1 rounded-md text-sm font-medium transition-colors"
          (click)="onFilterChange(null)"
        >
          All
        </button>
        <button
          [class]="
            selectedFilter === 'draft'
              ? 'bg-purple-600 text-white'
              : 'bg-gray-700 text-gray-300'
          "
          class="px-3 py-1 rounded-md text-sm font-medium transition-colors"
          (click)="onFilterChange('draft')"
        >
          Drafts
        </button>
        <button
          [class]="
            selectedFilter === 'scheduled'
              ? 'bg-purple-600 text-white'
              : 'bg-gray-700 text-gray-300'
          "
          class="px-3 py-1 rounded-md text-sm font-medium transition-colors"
          (click)="onFilterChange('scheduled')"
        >
          Scheduled
        </button>
        <button
          [class]="
            selectedFilter === 'published'
              ? 'bg-purple-600 text-white'
              : 'bg-gray-700 text-gray-300'
          "
          class="px-3 py-1 rounded-md text-sm font-medium transition-colors"
          (click)="onFilterChange('published')"
        >
          Published
        </button>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="p-6 flex-grow">
    <!-- Loading State -->
    <div *ngIf="loading$ | async" class="flex justify-center items-center h-40">
      <div
        class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"
      ></div>
    </div>

    <!-- Error State -->
    <div
      *ngIf="(error$ | async) && !(loading$ | async)"
      class="bg-red-900/30 border border-red-700 text-red-100 px-4 py-3 rounded mb-4"
    >
      <p>There was an error loading newsletters. Please try again later.</p>
    </div>

    <!-- Empty State -->
    <div
      *ngIf="
        (newsletters$ | async)?.length === 0 &&
        !(loading$ | async) &&
        !(error$ | async)
      "
      class="flex flex-col items-center justify-center h-40 text-gray-400"
    >
      <app-icon iconName="noNewsletterFoundIcon" />
      <p class="text-lg">No newsletters found</p>
      <button
        (click)="openCreateModal()"
        class="mt-4 text-purple-400 hover:text-purple-300 underline flex items-center"
      >
        <app-icon iconName="createNewsletterIcon" />
        Create your first newsletter
      </button>
    </div>

    <!-- Newsletter List -->
    <div
      *ngIf="newsletters$ | async as newsletters"
      class="grid grid-cols-1 gap-4"
    >
      <ng-container *ngIf="newsletters.length > 0 && !(loading$ | async)">
        <div
          *ngFor="let newsletter of newsletters"
          class="bg-gray-800 border border-gray-700 rounded-lg hover:border-purple-500 transition-colors cursor-pointer p-4"
          (click)="onNewsletterSelect(newsletter._id!)"
        >
          <!-- Rest of your newsletter template remains the same -->
          <div class="flex justify-between items-start">
            <div class="flex items-center">
              <div
                class="flex-shrink-0 h-12 w-12 rounded-md overflow-hidden bg-gray-700 mr-4"
              >
                <img
                  *ngIf="newsletter.image"
                  [src]="newsletter.image"
                  alt="Newsletter cover"
                  class="h-full w-full object-cover"
                />
                <div
                  *ngIf="!newsletter.image"
                  class="h-full w-full flex items-center justify-center text-gray-500"
                >
                  <app-icon iconName="defaultImageNewsletter" />
                </div>
              </div>
              <div>
                <h3 class="text-lg font-medium">{{ newsletter.title }}</h3>
                <p class="text-sm text-gray-400 mt-1 line-clamp-2">
                  {{ newsletter.description }}
                </p>
                <div class="flex items-center mt-2 space-x-4">
                  <span class="text-xs text-gray-500">{{
                    newsletter.createdAt | date
                  }}</span>
                  <span class="flex items-center text-xs">
                    <app-icon iconName="newsletterRecipientCountIcon" />
                    {{ newsletter.recipientCount || 0 }}
                  </span>
                  <span
                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                    [ngClass]="{
                      'bg-gray-700 text-gray-300':
                        newsletter.status === 'draft',
                      'bg-yellow-900/30 text-yellow-300':
                        newsletter.status === 'scheduled',
                      'bg-green-900/30 text-green-300':
                        newsletter.status === 'published'
                    }"
                  >
                    {{ newsletter.status | titlecase }}
                  </span>
                </div>
              </div>
            </div>

            <div class="flex space-x-2">
              <button
                *ngIf="newsletter && newsletter.status !== 'published'"
                (click)="openSendConfirmation(newsletter._id || '', $event)"
                class="text-gray-400 hover:text-blue-400 transition-colors"
              >
                <app-icon iconName="newsletterPublishedStatusIcon" />
              </button>
              <button
                *ngIf="newsletter"
                (click)="openDeleteConfirmation(newsletter._id || '', $event)"
                class="text-gray-400 hover:text-red-400 transition-colors"
              >
                <app-icon iconName="deleteConfirmationIcon" />
              </button>
            </div>
          </div>
        </div>
      </ng-container>
    </div>

    <!-- Show message when no newsletters are available -->
    <div
      *ngIf="(newsletters$ | async)?.length === 0 && !(loading$ | async)"
      class="p-6 text-center text-gray-400"
    >
      No newsletters found. Create one to get started.
    </div>

    <div *ngIf="loading$ | async" class="p-6 text-center text-gray-400">
      Loading newsletters...
    </div>

    <div
      *ngIf="(pagination$ | async) && (pagination$ | async)!.pages > 1"
      class="flex justify-center mt-6"
    >
      <nav class="flex items-center">
        <button
          [disabled]="currentPage === 1"
          (click)="onPageChange(currentPage - 1)"
          [class.opacity-50]="currentPage === 1"
          class="px-3 py-1 rounded-md bg-gray-700 text-gray-300 mx-1"
        >
          <app-icon iconName="pageChangeIcon" />
        </button>

        <span class="text-sm text-gray-400 mx-2">
          Page {{ currentPage }} of {{ (pagination$ | async)?.pages }}
        </span>

        <button
          [disabled]="currentPage === (pagination$ | async)?.pages"
          (click)="onPageChange(currentPage + 1)"
          [class.opacity-50]="currentPage === (pagination$ | async)?.pages"
          class="px-3 py-1 rounded-md bg-gray-700 text-gray-300 mx-1"
        >
          <app-icon iconName="openPageChange01Icon" />
        </button>
      </nav>
    </div>
  </div>

  <!-- Updated newsletter creation form with two-column layout -->
  <app-modal *ngIf="showCreateModal" (close)="closeCreateModal()">
    <ng-container header>
      <h2 class="text-xl font-semibold">Create Newsletter</h2>
    </ng-container>

    <ng-container body>
      <div #modalBody class="space-y-6">
        <form
          [formGroup]="newsletterForm"
          (ngSubmit)="submitForm()"
          class="space-y-6"
        >
          <!-- Progress Steps -->
          <div class="mb-8">
            <div class="relative">
              <div class="flex justify-between mb-2">
                <span class="text-xs font-medium text-purple-400"
                  >Basic Info</span
                >
                <span class="text-xs font-medium text-gray-400">Content</span>
                <span class="text-xs font-medium text-gray-400">Preview</span>
              </div>
              <div class="overflow-hidden h-2 flex rounded-full bg-gray-700">
                <div
                  class="bg-gradient-to-r from-purple-500 to-indigo-600 w-1/3 rounded-full shadow-lg transition-all duration-500 ease-in-out"
                ></div>
              </div>
            </div>
          </div>

          <!-- Two-column grid layout with glass effect -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Left column -->
            <div
              class="space-y-6 backdrop-blur-sm bg-gray-800/40 rounded-xl p-6 border border-gray-700/50 shadow-xl"
            >
              <!-- Title with floating label -->
              <div class="relative">
                <input
                  id="title"
                  formControlName="title"
                  type="text"
                  placeholder=" "
                  class="peer w-full px-4 py-3 bg-gray-800/70 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300"
                />
                <label
                  for="title"
                  class="absolute left-4 -top-3 text-xs font-medium text-purple-400 bg-gray-800 px-2 transition-all duration-300"
                  >Newsletter Title*</label
                >
                <div
                  *ngIf="
                    newsletterForm.get('title')?.invalid &&
                    newsletterForm.get('title')?.touched
                  "
                  class="text-red-400 text-xs mt-1 flex items-center"
                >
                  <app-icon iconName="warningTitleIcon" />
                  Title is required and must be less than 100 characters
                </div>
              </div>

              <!-- Description with animated border -->
              <div class="relative">
                <textarea
                  id="description"
                  formControlName="description"
                  rows="4"
                  placeholder=" "
                  class="peer w-full px-4 py-3 bg-gray-800/70 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300 resize-none"
                ></textarea>
                <label
                  for="description"
                  class="absolute left-4 -top-3 text-xs font-medium text-purple-400 bg-gray-800 px-2 transition-all duration-300"
                  >Newsletter Description*</label
                >
                <div
                  *ngIf="
                    newsletterForm.get('description')?.invalid &&
                    newsletterForm.get('description')?.touched
                  "
                  class="text-red-400 text-xs mt-1 flex items-center"
                >
                  <app-icon iconName="warningTitleIcon" />
                  Description is required and must be less than 500 characters
                </div>
                <div class="text-xs text-gray-400 mt-1 flex items-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-3 w-3 mr-1"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  A compelling description will increase your newsletter's reach
                </div>
              </div>

              <!-- Publish Frequency with custom select -->
              <div class="relative">
                <label
                  for="publishFrequency"
                  class="absolute left-4 -top-3 text-xs font-medium text-purple-400 bg-gray-800 px-2 z-10"
                  >Publish Frequency*</label
                >
                <div class="relative">
                  <select
                    id="publishFrequency"
                    formControlName="publishFrequency"
                    class="appearance-none w-full px-4 py-3 bg-gray-800/70 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300"
                  >
                    <option
                      *ngFor="let option of publishFrequencyOptions"
                      [value]="option.value"
                    >
                      {{ option.label }}
                    </option>
                  </select>
                  <div
                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-purple-400"
                  >
                    <app-icon iconName="dropdownArrowIcon" />
                  </div>
                </div>
              </div>

              <!-- Status with modern toggle buttons -->
              <div class="relative">
                <label
                  class="absolute left-4 -top-3 text-xs font-medium text-purple-400 bg-gray-800 px-2 z-10"
                  >Status</label
                >
                <div
                  class="flex p-1 space-x-1 bg-gray-800/80 rounded-lg border border-gray-700/50 shadow-inner"
                >
                  <label
                    class="flex-1 flex items-center justify-center py-2 px-3 rounded-md cursor-pointer transition-all duration-300"
                    [class.bg-gradient-to-r]="
                      newsletterForm.get('status')?.value === 'draft'
                    "
                    [class.from-purple-600]="
                      newsletterForm.get('status')?.value === 'draft'
                    "
                    [class.to-purple-700]="
                      newsletterForm.get('status')?.value === 'draft'
                    "
                    [class.shadow-lg]="
                      newsletterForm.get('status')?.value === 'draft'
                    "
                  >
                    <input
                      type="radio"
                      formControlName="status"
                      value="draft"
                      class="sr-only"
                    />
                    <app-icon iconName="draftIcon" />
                    <span class="text-sm">Draft</span>
                  </label>
                  <label
                    class="flex-1 flex items-center justify-center py-2 px-3 rounded-md cursor-pointer transition-all duration-300"
                    [class.bg-gradient-to-r]="
                      newsletterForm.get('status')?.value === 'scheduled'
                    "
                    [class.from-blue-600]="
                      newsletterForm.get('status')?.value === 'scheduled'
                    "
                    [class.to-blue-700]="
                      newsletterForm.get('status')?.value === 'scheduled'
                    "
                    [class.shadow-lg]="
                      newsletterForm.get('status')?.value === 'scheduled'
                    "
                  >
                    <input
                      type="radio"
                      formControlName="status"
                      value="scheduled"
                      class="sr-only"
                    />
                    <app-icon iconName="scheduledIcon" />
                    <span class="text-sm">Scheduled</span>
                  </label>
                  <label
                    class="flex-1 flex items-center justify-center py-2 px-3 rounded-md cursor-pointer transition-all duration-300"
                    [class.bg-gradient-to-r]="
                      newsletterForm.get('status')?.value === 'published'
                    "
                    [class.from-green-600]="
                      newsletterForm.get('status')?.value === 'published'
                    "
                    [class.to-green-700]="
                      newsletterForm.get('status')?.value === 'published'
                    "
                    [class.shadow-lg]="
                      newsletterForm.get('status')?.value === 'published'
                    "
                  >
                    <input
                      type="radio"
                      formControlName="status"
                      value="published"
                      class="sr-only"
                    />
                    <app-icon iconName="publishedIcon" />
                    <span class="text-sm">Published</span>
                  </label>
                </div>
              </div>
            </div>

            <!-- Right column -->
            <div
              class="space-y-6 backdrop-blur-sm bg-gray-800/40 rounded-xl p-6 border border-gray-700/50 shadow-xl"
            >
              <!-- Newsletter Image with preview and animations -->
              <div class="relative">
                <label
                  class="absolute left-4 -top-3 text-xs font-medium text-purple-400 bg-gray-800 px-2 z-10"
                  >Newsletter Image</label
                >

                <div
                  *ngIf="!imagePreview"
                  class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-purple-500 transition-all duration-300 group relative overflow-hidden"
                  (click)="fileInput.click()"
                >
                  <div
                    class="absolute inset-0 bg-gradient-to-br from-purple-500/10 to-indigo-500/10 transform scale-0 group-hover:scale-100 transition-transform duration-500 rounded-lg"
                  ></div>

                  <app-icon iconName="imagePreviewIcon" />
                  <p
                    class="mt-4 text-sm text-gray-300 group-hover:text-white transition-colors duration-300"
                  >
                    Click to upload an image
                  </p>
                  <p
                    class="text-xs text-gray-500 mt-1 group-hover:text-gray-300 transition-colors duration-300"
                  >
                    Recommended size: 300x300 pixels
                  </p>
                  <p
                    class="text-xs text-purple-400/70 mt-3 group-hover:text-purple-400 transition-colors duration-300"
                  >
                    Supports JPG, PNG and GIF formats
                  </p>
                </div>

                <div
                  *ngIf="imagePreview"
                  class="relative rounded-lg overflow-hidden shadow-2xl group"
                >
                  <img
                    [src]="imagePreview"
                    alt="Preview"
                    class="w-full h-64 object-cover transition-transform duration-500 group-hover:scale-105"
                  />
                  <div
                    class="absolute inset-0 bg-gradient-to-t from-gray-900/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"
                  ></div>
                  <button
                    type="button"
                    (click)="removeImage()"
                    class="absolute bottom-4 right-4 bg-gray-900/70 hover:bg-red-600 p-2 rounded-full transition-colors duration-300 opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 transition-all"
                  >
                    <app-icon iconName="removeImageIcon" />
                  </button>
                  <button
                    type="button"
                    (click)="fileInput.click()"
                    class="absolute bottom-4 left-4 bg-gray-900/70 hover:bg-purple-600 p-2 rounded-full transition-colors duration-300 opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 transition-all"
                  >
                    <app-icon iconName="fileInputIcon" />
                  </button>
                </div>

                <input
                  #fileInput
                  type="file"
                  accept="image/*"
                  class="hidden"
                  (change)="onImageChange($event)"
                />
              </div>
            </div>
          </div>

          <!-- Content Editor - full width below both columns -->
          <div>
            <label
              for="content"
              class="block text-sm font-medium text-gray-300 mb-1"
              >Newsletter Content*</label
            >
            <app-editor
              [initialContent]="newsletterForm.value.content"
              (contentChange)="onEditorContentChange($event)"
            ></app-editor>
            <div
              *ngIf="
                newsletterForm.get('content')?.invalid &&
                newsletterForm.get('content')?.touched
              "
              class="text-red-400 text-sm mt-1"
            >
              Content is required
            </div>
          </div>
        </form>
      </div>
    </ng-container>

    <ng-container footer>
      <div class="flex justify-end space-x-3">
        <button
          type="button"
          (click)="closeCreateModal()"
          class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-md text-sm font-medium transition-colors"
        >
          Cancel
        </button>
        <button
          type="button"
          (click)="submitForm()"
          [disabled]="newsletterForm.invalid || (createLoading$ | async)"
          class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md text-sm font-medium transition-colors flex items-center"
          [class.opacity-50]="
            newsletterForm.invalid || (createLoading$ | async)
          "
        >
          <span *ngIf="createLoading$ | async" class="mr-2">
            <app-icon iconName="saveNewsletterIcon" />
          </span>
          Save Newsletter
        </button>
      </div>
    </ng-container>
  </app-modal>
  <!-- Updated Delete Confirmation Modal -->
  <app-modal
    *ngIf="showDeleteConfirmation"
    (close)="closeDeleteConfirmation()"
    size="sm"
  >
    <ng-container header>
      <div class="flex items-center text-red-400">
        <app-icon iconName="confirmDeletionIcon" />
        <h2 class="text-xl font-semibold">Confirm Deletion</h2>
      </div>
    </ng-container>

    <ng-container body>
      <div class="p-2">
        <p class="text-gray-300 mb-4">
          Are you sure you want to delete this newsletter? This action cannot be
          undone.
        </p>

        <div class="bg-red-900/20 border border-red-800/30 rounded-md p-4 mt-4">
          <div class="flex items-center">
            <app-icon iconName="waringDeletionIcon" />
            <span class="font-medium text-red-400">Warning</span>
          </div>
          <p class="text-sm text-gray-300 mt-2">
            This will permanently delete the newsletter and all related
            statistics.
          </p>
        </div>
      </div>
    </ng-container>

    <ng-container footer>
      <div class="flex justify-end space-x-3">
        <button
          type="button"
          (click)="closeDeleteConfirmation()"
          class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-md text-sm font-medium transition-colors"
        >
          Cancel
        </button>
        <button
          type="button"
          (click)="confirmDelete()"
          [disabled]="deleteLoading$ | async"
          class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md text-sm font-medium transition-colors flex items-center"
        >
          <span *ngIf="deleteLoading$ | async" class="mr-2">
            <app-icon iconName="deleteLoadingIcon" />
          </span>
          Delete
        </button>
      </div>
    </ng-container>
  </app-modal>

  <!--  Send Newsletter Confirmation Modal-->
  <app-modal
    *ngIf="showSendConfirmation"
    (close)="closeSendConfirmation()"
    size="sm"
  >
    <ng-container header>
      <div class="flex items-center text-blue-400">
        <app-icon iconName="sendNewsletterIcon" />
        <h2 class="text-xl font-semibold">Send Newsletter</h2>
      </div>
    </ng-container>

    <ng-container body>
      <div class="p-2">
        <p class="text-gray-300 mb-4">
          Are you sure you want to send this newsletter to all subscribers? This
          action cannot be undone.
        </p>

        <div class="bg-blue-900/20 border border-blue-800/30 rounded-md p-4">
          <div class="flex items-center">
            <app-icon iconName="newsletterRecipientCountIcon" />
            <span class="font-medium text-blue-400">Recipients</span>
          </div>
          <p class="text-sm text-gray-300 mt-2">
            This newsletter will be sent to approximately
            <span class="font-bold text-white">{{
              newsletterRecipientsCount
            }}</span>
            subscribers.
          </p>
        </div>
      </div>
    </ng-container>

    <ng-container footer>
      <div class="flex justify-end space-x-3">
        <button
          type="button"
          (click)="closeSendConfirmation()"
          class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-md text-sm font-medium transition-colors"
        >
          Cancel
        </button>
        <button
          type="button"
          (click)="confirmSend()"
          [disabled]="sendLoading$ | async"
          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium transition-colors flex items-center"
        >
          <span *ngIf="sendLoading$ | async" class="mr-2">
            <app-icon iconName="deleteLoadingIcon" />
          </span>
          Send Newsletter
        </button>
      </div>
    </ng-container>
  </app-modal>
</div>
