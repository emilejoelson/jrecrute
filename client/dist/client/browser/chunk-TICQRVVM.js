import{m as A,n as M,o as N,p as b}from"./chunk-JQUPMY2N.js";import{a as q}from"./chunk-UDC6AKOK.js";import{A as D,C as G,E as $,M as W,N as j,O as H,p as k,x as C}from"./chunk-ZQEZGJWL.js";import{m as L,o as T,q as O}from"./chunk-SFMJUAJJ.js";import{c as R,d as B}from"./chunk-7ATKAJYE.js";import{$b as V,Aa as P,Ac as d,Ba as y,Cb as _,Ga as S,Mb as p,Wb as n,Xb as a,Yb as h,cc as f,da as v,dc as c,e as I,j as E,lb as r,mc as m,oc as u,pa as x,wb as F,ya as w,za as g,zc as l}from"./chunk-O57XHFJQ.js";function U(i,s){if(i&1&&(n(0,"div",21),m(1),a()),i&2){let t,o=c(2);r(),u(" ",(t=o.passwordForm.get("current_password"))==null||t.errors==null?null:t.errors.serverError," ")}}function J(i,s){i&1&&(n(0,"div",21),m(1),l(2,"translate"),a()),i&2&&(r(),u(" ",d(2,1,"PROFILE.VALIDATION.MIN_LENGTH_6")," "))}function K(i,s){i&1&&(n(0,"div",21),m(1),l(2,"translate"),a()),i&2&&(r(),u(" ",d(2,1,"PROFILE.VALIDATION.PASSWORD_MISMATCH")," "))}function Q(i,s){if(i&1&&(n(0,"div",21),m(1),a()),i&2){let t,o=c(2);r(),u(" ",(t=o.passwordForm.get("confirm_password"))==null||t.errors==null?null:t.errors.serverError," ")}}function X(i,s){i&1&&h(0,"span",22)}function Y(i,s){i&1&&(n(0,"div",23),m(1),l(2,"translate"),a()),i&2&&(r(),u(" ",d(2,1,"PROFILE.PASSWORD_CHANGED_SUCCESS")," "))}function Z(i,s){if(i&1){let t=V();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3",4),P(),n(4,"svg",5),h(5,"path",6),a(),m(6),l(7,"translate"),a(),y(),n(8,"button",7),f("click",function(){w(t);let e=c();return g(e.close())}),P(),n(9,"svg",8),h(10,"path",9),a()()(),y(),n(11,"form",10),f("ngSubmit",function(){w(t);let e=c();return g(e.changePassword())}),n(12,"div",11)(13,"app-custom-input",12),l(14,"translate"),f("togglePassword",function(){w(t);let e=c();return g(e.togglePasswordVisibility(1))}),a(),_(15,U,2,1,"div",13),n(16,"app-custom-input",12),l(17,"translate"),f("togglePassword",function(){w(t);let e=c();return g(e.togglePasswordVisibility(2))}),a(),_(18,J,3,3,"div",13),n(19,"app-custom-input",12),l(20,"translate"),f("togglePassword",function(){w(t);let e=c();return g(e.togglePasswordVisibility(3))}),a(),_(21,K,3,3,"div",13)(22,Q,2,1,"div",13),a(),n(23,"div",14)(24,"button",15),f("click",function(){w(t);let e=c();return g(e.close())}),m(25),l(26,"translate"),a(),n(27,"button",16),l(28,"async"),P(),n(29,"svg",17),h(30,"path",18),a(),_(31,X,1,0,"span",19),l(32,"async"),m(33),l(34,"translate"),a()(),_(35,Y,3,3,"div",20),l(36,"async"),a()()()}if(i&2){let t,o,e=c();r(6),u(" ",d(7,32,"PROFILE.CHANGE_PASSWORD")," "),r(5),p("formGroup",e.passwordForm),r(2),p("id",e.accountCurrentPassWord.id)("classInput",e.accountCurrentPassWord.classControl)("classLabel",e.accountCurrentPassWord.classLabel)("title",d(14,34,e.accountCurrentPassWord.title))("formGroup",e.passwordForm)("type",e.passwordVisibility?"text":"password")("hasTogglePassword",!0),r(2),p("ngIf",e.hasError("current_password","serverError")),r(),p("id",e.accountNewPassword.id)("classInput",e.accountNewPassword.classControl)("classLabel",e.accountNewPassword.classLabel)("title",d(17,36,e.accountNewPassword.title))("formGroup",e.passwordForm)("type",e.passwordVisibility?"text":"password")("hasTogglePassword",!0),r(2),p("ngIf",e.hasError("new_password","minlength")&&((t=e.passwordForm.get("new_password"))==null?null:t.touched)),r(),p("id",e.accountConfirmPassword.id)("classInput",e.accountConfirmPassword.classControl)("classLabel",e.accountConfirmPassword.classLabel)("title",d(20,38,e.accountConfirmPassword.title))("formGroup",e.passwordForm)("type",e.passwordVisibility?"text":"password")("hasTogglePassword",!0),r(2),p("ngIf",e.hasError("confirm_password","passwordMismatch")&&((o=e.passwordForm.get("confirm_password"))==null?null:o.touched)),r(),p("ngIf",e.hasError("confirm_password","serverError")),r(3),u(" ",d(26,40,"PROFILE.CANCEL")," "),r(2),p("disabled",e.passwordForm.invalid||d(28,42,e.isChangingPassword$)),r(4),p("ngIf",d(32,44,e.isChangingPassword$)),r(2),u(" ",d(34,46,"PROFILE.SAVE")," "),r(2),p("ngIf",d(36,48,e.passwordChangeSuccess$))}}var z=class i{isVisible=!1;visibleChange=new S;passwordForm;passwordVisibility=!1;fb=x(W);store=x(k);isChangingPassword$=this.store.select(A);passwordChangeSuccess$=this.store.select(M);passwordChangeError$=this.store.select(N);destroy$=new E;subscription=new I;commonInputClass="peer w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-200 focus:outline-none focus:border-purple-500 appearance-none";commonLabelClass="left-3 -top-2.5 text-sm text-gray-600 bg-white px-1";accountCurrentPassWord={id:"current_password",type:"current_password",title:"PROFILE.CURRENT_PASSWORD",classControl:this.commonInputClass,classLabel:this.commonLabelClass};accountNewPassword={id:"new_password",type:"new_password",title:"PROFILE.NEW_PASSWORD",classControl:this.commonInputClass,classLabel:this.commonLabelClass};accountConfirmPassword={id:"confirm_password",type:"confirm_password",title:"PROFILE.CONFIRM_PASSWORD",classControl:this.commonInputClass,classLabel:this.commonLabelClass};ngOnInit(){this.initPasswordForm(),this.setupSubscriptions()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.subscription.unsubscribe()}setupSubscriptions(){this.subscription.add(this.passwordChangeSuccess$.pipe(v(this.destroy$)).subscribe(s=>{s&&(this.close(),this.passwordForm.reset(),setTimeout(()=>{this.store.dispatch(b.resetPasswordState())},3e3))})),this.subscription.add(this.passwordChangeError$.pipe(v(this.destroy$)).subscribe(s=>{s&&(s.field==="current_password"?this.passwordForm.get("current_password")?.setErrors({serverError:s.message}):s.field==="confirm_password"&&this.passwordForm.get("confirm_password")?.setErrors({serverError:s.message}))}))}initPasswordForm(){this.passwordForm=this.fb.group({current_password:["",C.required],new_password:["",[C.required,C.minLength(6)]],confirm_password:["",C.required]},{validators:this.passwordMatchValidator})}passwordMatchValidator(s){let t=s.get("new_password")?.value,o=s.get("confirm_password")?.value;return t!==o?(s.get("confirm_password")?.setErrors({passwordMismatch:!0}),{passwordMismatch:!0}):null}changePassword(){if(this.passwordForm.valid){let s={current_password:this.passwordForm.get("current_password")?.value,new_password:this.passwordForm.get("new_password")?.value,confirm_password:this.passwordForm.get("confirm_password")?.value};this.store.dispatch(b.changePassword({payload:s}))}else this.passwordForm.markAllAsTouched()}togglePasswordVisibility(s){this.passwordVisibility=!this.passwordVisibility}close(){this.visibleChange.emit(!1),this.store.dispatch(b.resetPasswordState()),this.passwordForm.reset()}hasError(s,t){let o=this.passwordForm.get(s);return o?.touched&&o?.hasError(t)||!1}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=F({type:i,selectors:[["app-change-password-popup"]],inputs:{isVisible:"isVisible"},outputs:{visibleChange:"visibleChange"},decls:1,vars:1,consts:[["class","fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center px-4",4,"ngIf"],[1,"fixed","inset-0","bg-gray-900","bg-opacity-50","z-50","flex","items-center","justify-center","px-4"],[1,"bg-white","rounded-2xl","shadow-2xl","p-6","md:p-8","w-full","max-w-md","transform","transition-all","animate-fade-in-up"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-xl","font-bold","text-gray-800","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2","text-indigo-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"],[1,"text-gray-500","hover:text-gray-700","focus:outline-none",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[3,"ngSubmit","formGroup"],[1,"flex","flex-col","gap-5"],[3,"togglePassword","id","classInput","classLabel","title","formGroup","type","hasTogglePassword"],["class","text-red-500 text-sm mt-1",4,"ngIf"],[1,"flex","items-center","justify-end","space-x-3","mt-8"],["type","button",1,"px-5","py-2.5","rounded-lg","border","border-gray-300","text-gray-700","font-medium","hover:bg-gray-50","transition-colors",3,"click"],["type","submit",1,"px-5","py-2.5","rounded-lg","bg-indigo-600","text-white","font-medium","hover:bg-indigo-700","transition-all","duration-200","flex","items-center","disabled:bg-indigo-300","disabled:cursor-not-allowed",3,"disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],["class","inline-block mr-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin",4,"ngIf"],["class","mt-4 p-3 bg-green-100 text-green-700 rounded-lg",4,"ngIf"],[1,"text-red-500","text-sm","mt-1"],[1,"inline-block","mr-2","w-4","h-4","border-2","border-white","border-t-transparent","rounded-full","animate-spin"],[1,"mt-4","p-3","bg-green-100","text-green-700","rounded-lg"]],template:function(t,o){t&1&&_(0,Z,37,50,"div",0),t&2&&p("ngIf",o.isVisible)},dependencies:[O,L,T,B,R,j,G,D,q,H,$],encapsulation:2})};export{z as a};
